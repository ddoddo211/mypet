<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="petIns">

		<!-- 보험상품 -->
		<!-- 보험상품 리스트 목록가지고 오는 부분 -->
		<select id="prodPageList" parameterType="inspageVo" resultType="inspageVo">
			select * from
			(select ROWNUM rnum,
			A.*
			from (select * from insProd where insp_del = 'N' order by to_number(insp_id) asc) A)
			WHERE rnum between #{page}*#{pageSize}-(#{pageSize}-1) and #{page}*#{pageSize}
		</select>
		
		<!-- 보험상품 총갯수 -->
		<select id="getInsProductCnt" resultType="int">
			select count(*) from insprod
			where insp_del = 'N'
	  	</select>
	  	
	  	<!-- 보험상품 리스트 목록가지고 오는 부분 -->
		<select id="prodKindPageList" parameterType="inspageVo" resultType="inspageVo">
			select * from
			(select ROWNUM rnum,
			A.*
			from (select * from insProd where INSP_JOIN = #{petKind} and insp_del = 'N' order by to_number(insp_id) asc) A)
			WHERE rnum between #{page}*#{pageSize}-(#{pageSize}-1) and #{page}*#{pageSize}
		</select>
		
		<!-- 보험상품 총갯수(조건) -->
		<select id="getInsProductKindCnt" parameterType="String" resultType="int" >
			select count(*) from insprod  where INSP_JOIN = #{petKind} and insp_del = 'N'
	  	</select>
	  	
	  	<!-- 우리아이 보험상품 추천 리스트 가지고 오는 부분 -->
	  	<select id="prodProductRecommendation" parameterType="inspageVo" resultType="insProdVo">
		     select * from
		              (select ROWNUM rnum,
		                      A.*
		               from  (select * from insProd where insp_del = 'N' order by to_number(insp_id) asc)A)
				 WHERE  rnum BETWEEN #{page}*#{pageSize}-(#{pageSize}-1) and #{page}*#{pageSize}
		         and INSP_JOIN = #{petKind}
		         and INSP_MINAGE <![CDATA[<=]]> ${petBirth}
		         and INSP_MAXAGE <![CDATA[>=]]> ${petBirth}
		         and INSP_SICK = #{petSick}
		</select>
		
		<!-- 게시글 총갯수(우리아이보험추천) -->
		<select id="getProductRecommendationCnt" parameterType="inspageVo" resultType="int" >
			select count(*) from insprod 
			 where INSP_JOIN = #{petKind}
		       and INSP_MINAGE <![CDATA[<=]]> to_number(#{petBirth})
		       and INSP_MAXAGE <![CDATA[>=]]> to_number(#{petBirth})
		       and INSP_SICK = #{petSick}
		       and insp_del = 'N'
	  	</select>
		
		<!-- 보험상품 아이디를 매개변수로 줘서 보험상품 정보 가지고 오는 방법 -->
		<select id="getProdInfo" parameterType="String" resultType="insProdVo">
			select * from insprod
			where insp_id = #{prodId}
		</select>
		
		
		<!-- 플랜정보에 보험상품 추가하기 -->
		<insert id="planInsert" parameterType="insShVo">
			insert into insshopping
			values(insShopping_num.nextval,#{inssp_mem},#{inssp_insp})
		</insert>
		
		<!-- 플랜정보에 회원의 플랜정보에 추가된 보험상품 조회 -->
		<select id="memPlan" parameterType="String" resultType="insShVo">
			select * from insshopping , insprod
			 where inssp_insp = insp_id 
               and inssp_mem = #{inssp_mem}
		</select>
		
		<!-- 회원의 펫이 있는지 확인하는 부분 -->
		<select id="petList" parameterType="String" resultType="mypetVo">
			select *
			from mypet , petkind , prodsize
			where myp_petk = petk_id
			and petk_size = size_id
			and myp_mem = #{myp_mem}
		</select>
		
		<!-- 회원 정보를 가지고 오는 쿼리 -->
		<select id="memberInfo" parameterType="String" resultType="memVo">
			select *
			  from member
			where mem_id = #{mem_id}
		</select>
		
		<!-- 회원이 플랜정보 추가버튼을 클릭하였을때 이미 플랜정보에 추가되어진 상품인지 확인하는 부분 -->
		<select id="memShopping" parameterType="insShVo" resultType="insShVo">
			select * from insshopping
			where inssp_mem = #{inssp_mem}
			and inssp_insp= #{inssp_insp}
		</select>
		
		<!-- 플랜정보에서 보험상품삭제 버튼을 클릭하였을때 보험상품 아이디를 줘서 삭제하는 쿼리문 -->
		<delete id="insShProdDelete" parameterType="String">
			delete from insshopping 
			where inssp_id = #{inssp_id}
		</delete>
		
		<!-- 플랜정보에서 펫 삭제하기 버튼을 클릭하였을떄 펫의 아이디를 줘서 삭제하는 쿼리문  -->
		<delete id="mypetDel" parameterType="String">
			delete from mypet 
			where myp_id = #{myp_id}
		</delete>
		
		<!--반려동물 품종 가지고 오는 쿼리문-->
		<select id="petKind" parameterType="String" resultType="petkindVo">
			select * from petkind , prodsize , animal
			where petk_size = size_id
            and petk_am = AM_ID
            and am_name = #{am_name}
		</select>
		
		<!-- 플랜정보에서 나의 펫에 현재 보험가입이 되어 있는 상품 보여주기 -->
		<select id="petIsrAlready" parameterType="String" resultType="insVo">
			select * from insurance , insprod
			where  inssp_id = insp_id
			and mem_id = #{mem_id}
		</select>
		
		<!-- 보험가입을 위해서 진행 펫 id를 줘서 해당 펫 정보가지고 오기 -->
		<select id="mypetInfo" parameterType="String" resultType="mypetVo">
			select *
			from mypet , petkind , prodsize
			where myp_petk = petk_id
			and petk_size = size_id
			and MYP_ID = #{mem_id}
		</select>
		
		
</mapper>